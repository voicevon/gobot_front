{% extends "common_webpage.html" %}
{% block pyscript%}
<link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
<script defer src="https://pyscript.net/latest/pyscript.js"></script>
<py-config>
    [splashscreen]
    enabled = true
    [[fetch]]
    files = ["/static/request.py"]
</py-config>
{% endblock%}

{% block page_content %}
<div id="pyscript_ready">Py-Script is loading... </div>
<div id="values">
    {% for value in values %}
    <button>{{ value }} </button><br>
    {% endfor %}
</div>


<div>
    <button py-click="button_click()" id="button">Go !</button>
    <div>
        GET
        <ul id="left"></ul>
    </div>
    <div id="right">
        POST
        <ul id="right"></ul>
    </div>
</div>

<py-script>
    def button_click():
        print("aaaaaaaaaaaaaaaaaa")
        left = Element("left")
        left.element.innerText = "clicked"

    from pyscript import when
    @when("click", selector="#values button")
    def value_click(evt):
        print(evt.target.innerText)

    

    Element("pyscript_ready").element.innerText="Py-Script is ready."
</py-script>

<py-script>
import asyncio
import json
from request import request  # import our request function.

async def main():
    baseurl = "https://jsonplaceholder.typicode.com"

    # GET
    headers = {"Content-type": "application/json"}
    response = await request(f"{baseurl}/posts/2", method="GET", headers=headers)
    print(f"GET request=> status:{response.status}, json:{await response.json()}")

    # POST
    body = json.dumps({"title": "test_title", "body": "test body", "userId": 1})
    new_post = await request(f"{baseurl}/posts", body=body, method="POST", headers=headers)
    print(f"POST request=> status:{new_post.status}, json:{await new_post.json()}")

    # PUT
    body = json.dumps({"id": 1, "title": "test_title", "body": "test body", "userId": 2})
    new_post = await request(f"{baseurl}/posts/1", body=body, method="PUT", headers=headers)
    print(f"PUT request=> status:{new_post.status}, json:{await new_post.json()}")

    # DELETE
    new_post = await request(f"{baseurl}/posts/1", method="DELETE", headers=headers)
    print(f"DELETE request=> status:{new_post.status}, json:{await new_post.json()}")

asyncio.ensure_future(main())
</py-script>

{% endblock %}